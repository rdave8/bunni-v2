# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: `abi.encodePacked()` Hash Collision](#h-1-abiencodepacked-hash-collision)
  - [H-2: Unsafe Casting of integers](#h-2-unsafe-casting-of-integers)
  - [H-3: Incorrect Assembly Shift Parameter Order](#h-3-incorrect-assembly-shift-parameter-order)
  - [H-4: Storage Array Edited with Memory](#h-4-storage-array-edited-with-memory)
  - [H-5: Contract Name Reused in Different Files](#h-5-contract-name-reused-in-different-files)
  - [H-6: Dangerous strict equality checks on contract balances](#h-6-dangerous-strict-equality-checks-on-contract-balances)
  - [H-7: Contract locks Ether without a withdraw function](#h-7-contract-locks-ether-without-a-withdraw-function)
  - [H-8: Reentrancy: State change after external call](#h-8-reentrancy-state-change-after-external-call)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Unsafe ERC20 Operation](#l-2-unsafe-erc20-operation)
  - [L-3: Unspecific Solidity Pragma](#l-3-unspecific-solidity-pragma)
  - [L-4: Address State Variable Set Without Checks](#l-4-address-state-variable-set-without-checks)
  - [L-5: Public Function Not Used Internally](#l-5-public-function-not-used-internally)
  - [L-6: Literal Instead of Constant](#l-6-literal-instead-of-constant)
  - [L-7: Empty `require()` / `revert()` Statement](#l-7-empty-require--revert-statement)
  - [L-8: `nonReentrant` is Not the First Modifier](#l-8-nonreentrant-is-not-the-first-modifier)
  - [L-9: Empty Block](#l-9-empty-block)
  - [L-10: Internal Function Used Only Once](#l-10-internal-function-used-only-once)
  - [L-11: Unused Error](#l-11-unused-error)
  - [L-12: Unused State Variable](#l-12-unused-state-variable)
  - [L-13: Costly operations inside loop](#l-13-costly-operations-inside-loop)
  - [L-14: Unused Import](#l-14-unused-import)
  - [L-15: State Change Without Event](#l-15-state-change-without-event)
  - [L-16: State Variable Could Be Immutable](#l-16-state-variable-could-be-immutable)
  - [L-17: Unchecked Return](#l-17-unchecked-return)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 66 |
| Total nSLOC | 10332 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| src/BunniHook.sol | 568 |
| src/BunniHub.sol | 474 |
| src/BunniToken.sol | 102 |
| src/BunniZone.sol | 36 |
| src/base/BaseHook.sol | 21 |
| src/base/Constants.sol | 26 |
| src/base/ERC20.sol | 274 |
| src/base/ERC20Lockable.sol | 296 |
| src/base/Errors.sol | 45 |
| src/base/Guarded.sol | 28 |
| src/base/Ownable.sol | 98 |
| src/base/ReentrancyGuard.sol | 31 |
| src/base/SharedStructs.sol | 75 |
| src/interfaces/IBaseHook.sol | 17 |
| src/interfaces/IBunniHook.sol | 83 |
| src/interfaces/IBunniHub.sol | 131 |
| src/interfaces/IBunniQuoter.sol | 39 |
| src/interfaces/IBunniToken.sol | 25 |
| src/interfaces/IBunniZone.sol | 9 |
| src/interfaces/IERC20.sol | 18 |
| src/interfaces/IERC20Lockable.sol | 14 |
| src/interfaces/IERC20Unlocker.sol | 5 |
| src/interfaces/IHooklet.sol | 110 |
| src/interfaces/ILiquidityDensityFunction.sol | 65 |
| src/interfaces/IOwnable.sol | 17 |
| src/ldf/BuyTheDipGeometricDistribution.sol | 179 |
| src/ldf/CarpetedDoubleGeometricDistribution.sol | 128 |
| src/ldf/CarpetedGeometricDistribution.sol | 136 |
| src/ldf/DoubleGeometricDistribution.sol | 191 |
| src/ldf/GeometricDistribution.sol | 135 |
| src/ldf/LibBuyTheDipGeometricDistribution.sol | 419 |
| src/ldf/LibCarpetedDoubleGeometricDistribution.sol | 374 |
| src/ldf/LibCarpetedGeometricDistribution.sol | 351 |
| src/ldf/LibDoubleGeometricDistribution.sol | 460 |
| src/ldf/LibGeometricDistribution.sol | 491 |
| src/ldf/LibUniformDistribution.sol | 265 |
| src/ldf/ShiftMode.sol | 13 |
| src/ldf/UniformDistribution.sol | 141 |
| src/ldf/managed/IOracle.sol | 4 |
| src/ldf/managed/LibOracleUniGeoDistribution.sol | 263 |
| src/ldf/managed/OracleUniGeoDistribution.sol | 281 |
| src/lib/AmAmmPayload.sol | 5 |
| src/lib/BlockNumberLib.sol | 11 |
| src/lib/BunniHookLogic.sol | 624 |
| src/lib/BunniHubLogic.sol | 576 |
| src/lib/BunniStateLibrary.sol | 52 |
| src/lib/BunniSwapMath.sol | 256 |
| src/lib/ExcessivelySafeTransfer2Lib.sol | 14 |
| src/lib/ExpMath.sol | 122 |
| src/lib/FeeMath.sol | 35 |
| src/lib/FullMathX96.sol | 35 |
| src/lib/HookletLib.sol | 356 |
| src/lib/LiquidityAmounts.sol | 21 |
| src/lib/Math.sol | 72 |
| src/lib/Oracle.sol | 224 |
| src/lib/OrderHashMemory.sol | 90 |
| src/lib/QueryLDF.sol | 85 |
| src/lib/QueryTWAP.sol | 12 |
| src/lib/RebalanceLogic.sol | 201 |
| src/lib/SqrtPriceMath.sol | 176 |
| src/lib/SwapMath.sol | 81 |
| src/lib/VaultMath.sol | 5 |
| src/periphery/BunniQuoter.sol | 597 |
| src/types/IdleBalance.sol | 47 |
| src/types/LDFType.sol | 6 |
| src/types/PoolState.sol | 191 |
| **Total** | **10332** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 8 |
| Low | 17 |


# High Issues

## H-1: `abi.encodePacked()` Hash Collision

abi.encodePacked() should not be used with dynamic types when passing the result to a hash function such as `keccak256()`. Use `abi.encode()` instead which will pad items to 32 bytes, preventing hash collisions: https://docs.soliditylang.org/en/v0.8.13/abi-spec.html#non-standard-packed-mode. (e.g. `abi.encodePacked(0x123,0x456)` => `0x123456` => `abi.encodePacked(0x1,0x23456)`, but `abi.encode(0x123,0x456)` => `0x0...1230...456`). Unless there is a compelling reason, `abi.encode` should be preferred. If there is only one argument to `abi.encodePacked()` it can often be cast to `bytes()` or `bytes32()` instead: https://ethereum.stackexchange.com/questions/30912/how-to-compare-strings-in-solidity#answer-82739. If all arguments are strings and or bytes, `bytes.concat()` should be used instead.

<details><summary>3 Found Instances</summary>


- Found in src/lib/OrderHashMemory.sol [Line: 20](src/lib/OrderHashMemory.sol#L20)

	```solidity
	    bytes32 public constant _ORDER_TYPEHASH = keccak256(abi.encodePacked(_ORDER_STRING, _HOOK_STRING, _ITEM_STRING));
	```

- Found in src/lib/OrderHashMemory.sol [Line: 22](src/lib/OrderHashMemory.sol#L22)

	```solidity
	        abi.encodePacked(_PERMIT_STRING, _HOOK_STRING, _ITEM_STRING, _ORDER_STRING, _TOKEN_PERMISSIONS_STRING)
	```

- Found in src/lib/OrderHashMemory.sol [Line: 25](src/lib/OrderHashMemory.sol#L25)

	```solidity
	        abi.encodePacked(
	```

</details>



## H-2: Unsafe Casting of integers

Downcasting int/uints in Solidity can be unsafe due to the potential for data loss and unintended behavior.When downcasting a larger integer type to a smaller one (e.g., uint256 to uint128), the value may exceed the range of the target type,leading to truncation and loss of significant digits. Use OpenZeppelin's SafeCast library to safely downcast integers.

<details><summary>3 Found Instances</summary>


- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 312](src/ldf/managed/OracleUniGeoDistribution.sol#L312)

	```solidity
	        ldfParamsOverride[id] = LdfParamsOverride({overridden: true, ldfParams: bytes12(ldfParams)});
	```

- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 366](src/ldf/managed/OracleUniGeoDistribution.sol#L366)

	```solidity
	        ldfState = bytes32(abi.encodePacked(true, lastOracleRick, bytes12(lastLdfParams)));
	```

- Found in src/lib/AmAmmPayload.sol [Line: 11](src/lib/AmAmmPayload.sol#L11)

	```solidity
	    swapFee0For1 = uint24(bytes3(payload));
	```

</details>



## H-3: Incorrect Assembly Shift Parameter Order

Example: `shl(shifted, 4)` will shift the right constant `4` by `a` bits. The correct order is `shl(4, shifted)`.

<details><summary>4 Found Instances</summary>


- Found in src/lib/ExpMath.sol [Line: 106](src/lib/ExpMath.sol#L106)

	```solidity
	            r := xor(r, byte(and(0x1f, shr(shr(r, x), 0x8421084210842108cc6318c6db6d54be)),
	```

- Found in src/lib/ExpMath.sol [Line: 123](src/lib/ExpMath.sol#L123)

	```solidity
	            p := sub(mul(p, x), shl(96, 795164235651350426258249787498))
	```

- Found in src/lib/ExpMath.sol [Line: 169](src/lib/ExpMath.sol#L169)

	```solidity
	            r := xor(r, byte(and(0x1f, shr(shr(r, x), 0x8421084210842108cc6318c6db6d54be)),
	```

- Found in src/lib/ExpMath.sol [Line: 186](src/lib/ExpMath.sol#L186)

	```solidity
	            p := sub(mul(p, x), shl(96, 795164235651350426258249787498))
	```

</details>



## H-4: Storage Array Edited with Memory

Storage reference is passed to a function with a memory parameter. This will not update the storage variable as expected. Consider using storage parameters instead.

<details><summary>1 Found Instances</summary>


- Found in src/lib/BunniHookLogic.sol [Line: 610](src/lib/BunniHookLogic.sol#L610)

	```solidity
	            : _getTwap(
	```

</details>



## H-5: Contract Name Reused in Different Files

When compiling contracts with certain development frameworks (for example: Truffle), having contracts with the same name across different files can lead to one being overwritten.

<details><summary>5 Found Instances</summary>


- Found in src/base/ERC20.sol [Line: 23](src/base/ERC20.sol#L23)

	```solidity
	abstract contract ERC20 is IERC20 {
	```

- Found in src/base/Ownable.sol [Line: 16](src/base/Ownable.sol#L16)

	```solidity
	abstract contract Ownable is IOwnable {
	```

- Found in src/lib/BlockNumberLib.sol [Line: 5](src/lib/BlockNumberLib.sol#L5)

	```solidity
	interface ArbSys {
	```

- Found in src/lib/BlockNumberLib.sol [Line: 12](src/lib/BlockNumberLib.sol#L12)

	```solidity
	library BlockNumberLib {
	```

- Found in src/lib/SqrtPriceMath.sol [Line: 12](src/lib/SqrtPriceMath.sol#L12)

	```solidity
	library SqrtPriceMath {
	```

</details>



## H-6: Dangerous strict equality checks on contract balances

A contract's balance can be forcibly manipulated by another selfdestructing contract. Therefore, it's recommended to use >, <, >= or <= instead of strict equality.

<details><summary>1 Found Instances</summary>


- Found in src/lib/BunniHubLogic.sol [Line: 236](src/lib/BunniHubLogic.sol#L236)

	```solidity
	            if (address(this).balance != 0) {
	```

</details>



## H-7: Contract locks Ether without a withdraw function

It appears that the contract includes a payable function to accept Ether but lacks a corresponding function to withdraw it, which leads to the Ether being locked in the contract. To resolve this issue, please implement a public or external function that allows for the withdrawal of Ether from the contract.

<details><summary>5 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 49](src/BunniHook.sol#L49)

	```solidity
	contract BunniHook is BaseHook, Ownable, IBunniHook, ReentrancyGuard, AmAmm, Extsload {
	```

- Found in src/BunniHub.sol [Line: 43](src/BunniHub.sol#L43)

	```solidity
	contract BunniHub is IBunniHub, Ownable, ReentrancyGuard {
	```

- Found in src/BunniToken.sol [Line: 32](src/BunniToken.sol#L32)

	```solidity
	contract BunniToken is IBunniToken, ERC20Lockable, Clone, Ownable {
	```

- Found in src/BunniZone.sol [Line: 17](src/BunniZone.sol#L17)

	```solidity
	contract BunniZone is IBunniZone, Ownable {
	```

- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 27](src/ldf/managed/OracleUniGeoDistribution.sol#L27)

	```solidity
	contract OracleUniGeoDistribution is ILiquidityDensityFunction, Guarded, Ownable {
	```

</details>



## H-8: Reentrancy: State change after external call

Changing state after an external call can lead to re-entrancy attacks.Use the checks-effects-interactions pattern to avoid this issue.

<details><summary>26 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 148](src/BunniHook.sol#L148)

	State is changed at: `weth = weth_`, `floodZone = floodZone_`, `_K = k_`, `deployTimestamp = block.timestamp`, `hookFeeRecipientController = hookFeeRecipientController_`
	```solidity
	        permit2 = address(floodPlain_.PERMIT2());
	```

- Found in src/BunniHub.sol [Line: 262](src/BunniHub.sol#L262)

	State is changed at: `s.poolState[poolId].rawBalance0 = state.rawBalance0`, `s.poolState[poolId].rawBalance1 = state.rawBalance1`, `s.reserve0[poolId] = state.reserve0`, `s.reserve1[poolId] = state.reserve1`
	```solidity
	            poolManager.transferFrom(address(key.hooks), address(this), inputToken.toId(), inputAmount);
	```

- Found in src/BunniHub.sol [Line: 282](src/BunniHub.sol#L282)

	State is changed at: `s.poolState[poolId].rawBalance0 = state.rawBalance0`, `s.poolState[poolId].rawBalance1 = state.rawBalance1`, `s.reserve0[poolId] = state.reserve0`, `s.reserve1[poolId] = state.reserve1`
	```solidity
	            poolManager.transfer(address(key.hooks), outputToken.toId(), outputAmount);
	```

- Found in src/lib/BunniHookLogic.sol [Line: 104](src/lib/BunniHookLogic.sol#L104)

	State is changed at: `(s.states[id].intermediateObservation, s.states[id].cardinality, s.states[id].cardinalityNext) =
            s.observations[id].initialize(uint32(block.timestamp - maxTwapSecondsAgo), tick)`, `s.states[id].cardinalityNext = cardinalityNextNew`
	```solidity
	        bytes memory hookData = hub.poolInitData();
	```

- Found in src/lib/BunniHookLogic.sol [Line: 152](src/lib/BunniHookLogic.sol#L152)

	State is changed at: `s.ldfStates[id] = newLdfState`, `s.slot0s[id] = Slot0({
                sqrtPriceX96: updatedSqrtPriceX96,
                tick: updatedTick,
                lastSwapTimestamp: blockTimestamp32,
                lastSurgeTimestamp: lastSurgeTimestamp
            })`, `s.curatorFees[id].accruedFee0 = uint120(newAccruedFee0)`, `s.totalCuratorFees[key.currency0] += newAccruedFee0 - curatorFees.accruedFee0`, `s.curatorFees[id].accruedFee1 = uint120(newAccruedFee1)`, `s.totalCuratorFees[key.currency1] += newAccruedFee1 - curatorFees.accruedFee1`, `delete s.rebalanceOrderHash[id]`, `delete s.rebalanceOrderPermit2Hash[id]`, `delete s.rebalanceOrderDeadline[id]`
	```solidity
	        PoolState memory bunniState = env.hub.poolState(id);
	```

- Found in src/lib/BunniHookLogic.sol [Line: 279](src/lib/BunniHookLogic.sol#L279)

	State is changed at: `s.slot0s[id] = Slot0({
                sqrtPriceX96: updatedSqrtPriceX96,
                tick: updatedTick,
                lastSwapTimestamp: blockTimestamp32,
                lastSurgeTimestamp: lastSurgeTimestamp
            })`, `s.curatorFees[id].accruedFee0 = uint120(newAccruedFee0)`, `s.totalCuratorFees[key.currency0] += newAccruedFee0 - curatorFees.accruedFee0`, `s.curatorFees[id].accruedFee1 = uint120(newAccruedFee1)`, `s.totalCuratorFees[key.currency1] += newAccruedFee1 - curatorFees.accruedFee1`, `delete s.rebalanceOrderHash[id]`, `delete s.rebalanceOrderPermit2Hash[id]`, `delete s.rebalanceOrderDeadline[id]`
	```solidity
	            env.hub.hookSetIdleBalance(
	```

- Found in src/lib/BunniHookLogic.sol [Line: 352](src/lib/BunniHookLogic.sol#L352)

	State is changed at: `s.curatorFees[id].accruedFee0 = uint120(newAccruedFee0)`, `s.totalCuratorFees[key.currency0] += newAccruedFee0 - curatorFees.accruedFee0`, `s.curatorFees[id].accruedFee1 = uint120(newAccruedFee1)`, `s.totalCuratorFees[key.currency1] += newAccruedFee1 - curatorFees.accruedFee1`, `delete s.rebalanceOrderHash[id]`, `delete s.rebalanceOrderPermit2Hash[id]`, `delete s.rebalanceOrderDeadline[id]`
	```solidity
	            IAmAmm.Bid memory topBid = IAmAmm(address(this)).getBidWrite(id, true);
	```

- Found in src/lib/BunniHookLogic.sol [Line: 519](src/lib/BunniHookLogic.sol#L519)

	State is changed at: `delete s.rebalanceOrderHash[id]`, `delete s.rebalanceOrderPermit2Hash[id]`, `delete s.rebalanceOrderDeadline[id]`
	```solidity
	        env.poolManager.mint(address(this), inputToken.toId(), inputAmount);
	```

- Found in src/lib/BunniHookLogic.sol [Line: 525](src/lib/BunniHookLogic.sol#L525)

	State is changed at: `delete s.rebalanceOrderHash[id]`, `delete s.rebalanceOrderPermit2Hash[id]`, `delete s.rebalanceOrderDeadline[id]`
	```solidity
	        env.hub.hookHandleSwap(
	```

- Found in src/lib/BunniHookLogic.sol [Line: 530](src/lib/BunniHookLogic.sol#L530)

	State is changed at: `delete s.rebalanceOrderHash[id]`, `delete s.rebalanceOrderPermit2Hash[id]`, `delete s.rebalanceOrderDeadline[id]`
	```solidity
	        env.poolManager.burn(address(this), outputToken.toId(), outputAmount);
	```

- Found in src/lib/BunniHubLogic.sol [Line: 105](src/lib/BunniHubLogic.sol#L105)

	State is changed at: `s.reserve0[poolId] = state.reserve0 + reserveChange`, `s.reserve1[poolId] = state.reserve1 + reserveChange`, `s.idleBalance[poolId] = IdleBalanceLibrary.ZERO`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        (uint160 sqrtPriceX96, int24 currentTick,,) = hook.slot0s(poolId);
	```

- Found in src/lib/BunniHubLogic.sol [Line: 106](src/lib/BunniHubLogic.sol#L106)

	State is changed at: `s.reserve0[poolId] = state.reserve0 + reserveChange`, `s.reserve1[poolId] = state.reserve1 + reserveChange`, `s.idleBalance[poolId] = IdleBalanceLibrary.ZERO`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        hook.updateStateMachine(poolId); // trigger am-AMM state machine update to avoid sandwiching rent burns
	```

- Found in src/lib/BunniHubLogic.sol [Line: 131](src/lib/BunniHubLogic.sol#L131)

	State is changed at: `s.reserve0[poolId] = state.reserve0 + reserveChange`, `s.reserve1[poolId] = state.reserve1 + reserveChange`, `s.idleBalance[poolId] = IdleBalanceLibrary.ZERO`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        (rawAmount0, rawAmount1) = abi.decode(
	```

- Found in src/lib/BunniHubLogic.sol [Line: 412](src/lib/BunniHubLogic.sol#L412)

	State is changed at: `s.queuedWithdrawals[poolId][msgSender].shareAmount = 0`, `s.reserve0[poolId] = state.reserve0 - reserveChange`, `s.reserve1[poolId] = state.reserve1 - reserveChange`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        IAmAmm.Bid memory topBid = hook.getBidWrite(poolId, true);
	```

- Found in src/lib/BunniHubLogic.sol [Line: 413](src/lib/BunniHubLogic.sol#L413)

	State is changed at: `s.queuedWithdrawals[poolId][msgSender].shareAmount = 0`, `s.reserve0[poolId] = state.reserve0 - reserveChange`, `s.reserve1[poolId] = state.reserve1 - reserveChange`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        if (hook.getAmAmmEnabled(poolId) && topBid.manager != address(0) && !params.useQueuedWithdrawal) {
	```

- Found in src/lib/BunniHubLogic.sol [Line: 417](src/lib/BunniHubLogic.sol#L417)

	State is changed at: `s.queuedWithdrawals[poolId][msgSender].shareAmount = 0`, `s.reserve0[poolId] = state.reserve0 - reserveChange`, `s.reserve1[poolId] = state.reserve1 - reserveChange`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        if (!hook.canWithdraw(poolId)) {
	```

- Found in src/lib/BunniHubLogic.sol [Line: 432](src/lib/BunniHubLogic.sol#L432)

	State is changed at: `s.queuedWithdrawals[poolId][msgSender].shareAmount = 0`, `s.reserve0[poolId] = state.reserve0 - reserveChange`, `s.reserve1[poolId] = state.reserve1 - reserveChange`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	        uint256 currentTotalSupply = state.bunniToken.totalSupply();
	```

- Found in src/lib/BunniHubLogic.sol [Line: 453](src/lib/BunniHubLogic.sol#L453)

	State is changed at: `s.reserve0[poolId] = state.reserve0 - reserveChange`, `s.reserve1[poolId] = state.reserve1 - reserveChange`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	            state.bunniToken.burn(address(this), shares); // BunniTokens were deposited to address(this) earlier with queueWithdraw()
	```

- Found in src/lib/BunniHubLogic.sol [Line: 456](src/lib/BunniHubLogic.sol#L456)

	State is changed at: `s.reserve0[poolId] = state.reserve0 - reserveChange`, `s.reserve1[poolId] = state.reserve1 - reserveChange`, `s.idleBalance[poolId] = newBalance.toIdleBalance(isToken0)`
	```solidity
	            state.bunniToken.burn(msgSender, shares);
	```

- Found in src/lib/BunniHubLogic.sol [Line: 560](src/lib/BunniHubLogic.sol#L560)

	State is changed at: `s.poolIdOfBunniToken[token] = poolId`, `s.nonce[bunniSubspace] = nonce_ + 1`, `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	            !params.liquidityDensityFunction.isValidParams(key, params.twapSecondsAgo, params.ldfParams, params.ldfType)
	```

- Found in src/lib/BunniHubLogic.sol [Line: 567](src/lib/BunniHubLogic.sol#L567)

	State is changed at: `s.poolIdOfBunniToken[token] = poolId`, `s.nonce[bunniSubspace] = nonce_ + 1`, `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	        if (!params.hooks.isValidParams(params.hookParams)) revert BunniHub__InvalidHookParams();
	```

- Found in src/lib/BunniHubLogic.sol [Line: 624](src/lib/BunniHubLogic.sol#L624)

	State is changed at: `s.poolIdOfBunniToken[token] = poolId`, `s.nonce[bunniSubspace] = nonce_ + 1`, `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	        token.initialize(params.owner, params.metadataURI);
	```

- Found in src/lib/BunniHubLogic.sol [Line: 649](src/lib/BunniHubLogic.sol#L649)

	State is changed at: `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	            uint8 currency0Decimals =
	```

- Found in src/lib/BunniHubLogic.sol [Line: 651](src/lib/BunniHubLogic.sol#L651)

	State is changed at: `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	            uint8 currency1Decimals =
	```

- Found in src/lib/BunniHubLogic.sol [Line: 653](src/lib/BunniHubLogic.sol#L653)

	State is changed at: `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	            uint8 vault0Decimals = params.vault0 == ERC4626(address(0)) ? 0 : params.vault0.decimals();
	```

- Found in src/lib/BunniHubLogic.sol [Line: 654](src/lib/BunniHubLogic.sol#L654)

	State is changed at: `s.poolState[poolId].immutableParamsPointer = immutableParams.write()`
	```solidity
	            uint8 vault1Decimals = params.vault1 == ERC4626(address(0)) ? 0 : params.vault1.decimals();
	```

</details>



# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>18 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 49](src/BunniHook.sol#L49)

	```solidity
	contract BunniHook is BaseHook, Ownable, IBunniHook, ReentrancyGuard, AmAmm, Extsload {
	```

- Found in src/BunniHook.sol [Line: 378](src/BunniHook.sol#L378)

	```solidity
	    function setZone(IZone zone) external onlyOwner {
	```

- Found in src/BunniHook.sol [Line: 402](src/BunniHook.sol#L402)

	```solidity
	    function setHookFeeModifier(uint32 newHookFeeModifier) external onlyOwner {
	```

- Found in src/BunniHook.sol [Line: 418](src/BunniHook.sol#L418)

	```solidity
	    function setWithdrawalUnblocked(PoolId id, bool unblocked) external onlyOwner {
	```

- Found in src/BunniHook.sol [Line: 424](src/BunniHook.sol#L424)

	```solidity
	    function scheduleKChange(uint48 newK, uint160 activeBlock) external onlyOwner {
	```

- Found in src/BunniHub.sol [Line: 43](src/BunniHub.sol#L43)

	```solidity
	contract BunniHub is IBunniHub, Ownable, ReentrancyGuard {
	```

- Found in src/BunniHub.sol [Line: 361](src/BunniHub.sol#L361)

	```solidity
	    function setPauser(address guy, bool status) external onlyOwner {
	```

- Found in src/BunniHub.sol [Line: 376](src/BunniHub.sol#L376)

	```solidity
	    function burnPauseFuse() external onlyOwner {
	```

- Found in src/BunniHub.sol [Line: 382](src/BunniHub.sol#L382)

	```solidity
	    function setHookWhitelist(IBunniHook hook, bool whitelisted) external onlyOwner {
	```

- Found in src/BunniToken.sol [Line: 32](src/BunniToken.sol#L32)

	```solidity
	contract BunniToken is IBunniToken, ERC20Lockable, Clone, Ownable {
	```

- Found in src/BunniToken.sol [Line: 137](src/BunniToken.sol#L137)

	```solidity
	    function setMetadataURI(string calldata metadataURI_) external override onlyOwner {
	```

- Found in src/BunniZone.sol [Line: 17](src/BunniZone.sol#L17)

	```solidity
	contract BunniZone is IBunniZone, Ownable {
	```

- Found in src/BunniZone.sol [Line: 35](src/BunniZone.sol#L35)

	```solidity
	    function setIsWhitelisted(address account, bool isWhitelisted_) external onlyOwner {
	```

- Found in src/base/Ownable.sol [Line: 114](src/base/Ownable.sol#L114)

	```solidity
	    function transferOwnership(address newOwner) public payable virtual onlyOwner {
	```

- Found in src/base/Ownable.sol [Line: 126](src/base/Ownable.sol#L126)

	```solidity
	    function renounceOwnership() public payable virtual onlyOwner {
	```

- Found in src/base/Ownable.sol [Line: 162](src/base/Ownable.sol#L162)

	```solidity
	    function completeOwnershipHandover(address pendingOwner) public payable virtual onlyOwner {
	```

- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 27](src/ldf/managed/OracleUniGeoDistribution.sol#L27)

	```solidity
	contract OracleUniGeoDistribution is ILiquidityDensityFunction, Guarded, Ownable {
	```

- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 303](src/ldf/managed/OracleUniGeoDistribution.sol#L303)

	```solidity
	    function setLdfParams(PoolKey calldata key, bytes32 ldfParams) public onlyOwner {
	```

</details>



## L-2: Unsafe ERC20 Operation

ERC20 functions may not behave as expected. For example: return values are not always meaningful. It is recommended to use OpenZeppelin's SafeERC20 library.

<details><summary>5 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 321](src/BunniHook.sol#L321)

	```solidity
	                    weth.transfer(recipient, balance);
	```

- Found in src/BunniHook.sol [Line: 842](src/BunniHook.sol#L842)

	```solidity
	        hub.bunniTokenOfPool(id).transfer(to, amount);
	```

- Found in src/BunniHook.sol [Line: 846](src/BunniHook.sol#L846)

	```solidity
	        poolManager.transfer(to, currency.toId(), amount);
	```

- Found in src/BunniHub.sol [Line: 282](src/BunniHub.sol#L282)

	```solidity
	            poolManager.transfer(address(key.hooks), outputToken.toId(), outputAmount);
	```

- Found in src/BunniHub.sol [Line: 619](src/BunniHub.sol#L619)

	```solidity
	                    currency.transfer(address(poolManager), excessAmount);
	```

</details>



## L-3: Unspecific Solidity Pragma

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

<details><summary>43 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 2](src/BunniHook.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/BunniHub.sol [Line: 3](src/BunniHub.sol#L3)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/BunniToken.sol [Line: 3](src/BunniToken.sol#L3)

	```solidity
	pragma solidity ^0.8.15;
	```

- Found in src/BunniZone.sol [Line: 3](src/BunniZone.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/base/BaseHook.sol [Line: 2](src/base/BaseHook.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/base/Constants.sol [Line: 3](src/base/Constants.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/base/ERC20.sol [Line: 2](src/base/ERC20.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in src/base/ERC20Lockable.sol [Line: 3](src/base/ERC20Lockable.sol#L3)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in src/base/Errors.sol [Line: 3](src/base/Errors.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/base/Guarded.sol [Line: 2](src/base/Guarded.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/base/Ownable.sol [Line: 2](src/base/Ownable.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in src/base/ReentrancyGuard.sol [Line: 2](src/base/ReentrancyGuard.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/base/SharedStructs.sol [Line: 3](src/base/SharedStructs.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/interfaces/IBaseHook.sol [Line: 3](src/interfaces/IBaseHook.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IBunniHook.sol [Line: 3](src/interfaces/IBunniHook.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/IBunniHub.sol [Line: 3](src/interfaces/IBunniHub.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/interfaces/IBunniQuoter.sol [Line: 3](src/interfaces/IBunniQuoter.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/interfaces/IBunniToken.sol [Line: 3](src/interfaces/IBunniToken.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/interfaces/IBunniZone.sol [Line: 3](src/interfaces/IBunniZone.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/interfaces/IERC20.sol [Line: 3](src/interfaces/IERC20.sol#L3)

	```solidity
	pragma solidity >=0.5.0;
	```

- Found in src/interfaces/IERC20Lockable.sol [Line: 3](src/interfaces/IERC20Lockable.sol#L3)

	```solidity
	pragma solidity >=0.5.0;
	```

- Found in src/interfaces/IERC20Unlocker.sol [Line: 3](src/interfaces/IERC20Unlocker.sol#L3)

	```solidity
	pragma solidity >=0.5.0;
	```

- Found in src/interfaces/IHooklet.sol [Line: 3](src/interfaces/IHooklet.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/interfaces/ILiquidityDensityFunction.sol [Line: 3](src/interfaces/ILiquidityDensityFunction.sol#L3)

	```solidity
	pragma solidity >=0.6.0;
	```

- Found in src/interfaces/IOwnable.sol [Line: 3](src/interfaces/IOwnable.sol#L3)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in src/ldf/BuyTheDipGeometricDistribution.sol [Line: 2](src/ldf/BuyTheDipGeometricDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/CarpetedDoubleGeometricDistribution.sol [Line: 2](src/ldf/CarpetedDoubleGeometricDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/CarpetedGeometricDistribution.sol [Line: 2](src/ldf/CarpetedGeometricDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/DoubleGeometricDistribution.sol [Line: 2](src/ldf/DoubleGeometricDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/GeometricDistribution.sol [Line: 2](src/ldf/GeometricDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/ShiftMode.sol [Line: 2](src/ldf/ShiftMode.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/UniformDistribution.sol [Line: 2](src/ldf/UniformDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/managed/IOracle.sol [Line: 1](src/ldf/managed/IOracle.sol#L1)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 2](src/ldf/managed/OracleUniGeoDistribution.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/lib/AmAmmPayload.sol [Line: 3](src/lib/AmAmmPayload.sol#L3)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/lib/FeeMath.sol [Line: 3](src/lib/FeeMath.sol#L3)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/lib/Math.sol [Line: 3](src/lib/Math.sol#L3)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/lib/QueryLDF.sol [Line: 3](src/lib/QueryLDF.sol#L3)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/lib/QueryTWAP.sol [Line: 3](src/lib/QueryTWAP.sol#L3)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/lib/VaultMath.sol [Line: 2](src/lib/VaultMath.sol#L2)

	```solidity
	pragma solidity ^0.8.20;
	```

- Found in src/periphery/BunniQuoter.sol [Line: 2](src/periphery/BunniQuoter.sol#L2)

	```solidity
	pragma solidity ^0.8.19;
	```

- Found in src/types/LDFType.sol [Line: 2](src/types/LDFType.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

- Found in src/types/PoolState.sol [Line: 2](src/types/PoolState.sol#L2)

	```solidity
	pragma solidity ^0.8.4;
	```

</details>



## L-4: Address State Variable Set Without Checks

Check for `address(0)` when assigning values to address state variables.

<details><summary>3 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 156](src/BunniHook.sol#L156)

	```solidity
	        floodZone = floodZone_;
	```

- Found in src/BunniHook.sol [Line: 379](src/BunniHook.sol#L379)

	```solidity
	        floodZone = zone;
	```

- Found in src/BunniHook.sol [Line: 397](src/BunniHook.sol#L397)

	```solidity
	        hookFeeRecipient = newHookFeeRecipient;
	```

</details>



## L-5: Public Function Not Used Internally

If a function is marked public but is not used internally, consider marking it as `external`.

<details><summary>1 Found Instances</summary>


- Found in src/ldf/managed/OracleUniGeoDistribution.sol [Line: 288](src/ldf/managed/OracleUniGeoDistribution.sol#L288)

	```solidity
	    function setLdfParams(
	```

</details>



## L-6: Literal Instead of Constant

Define and use `constant` variables instead of using literals. If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>103 Found Instances</summary>


- Found in src/BunniToken.sol [Line: 69](src/BunniToken.sol#L69)

	```solidity
	        return Currency.wrap(_getArgAddress(20));
	```

- Found in src/BunniToken.sol [Line: 73](src/BunniToken.sol#L73)

	```solidity
	        return Currency.wrap(_getArgAddress(40));
	```

- Found in src/BunniToken.sol [Line: 90](src/BunniToken.sol#L90)

	```solidity
	            currency0: Currency.wrap(_getArgAddress(20)),
	```

- Found in src/BunniToken.sol [Line: 91](src/BunniToken.sol#L91)

	```solidity
	            currency1: Currency.wrap(_getArgAddress(40)),
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 383](src/ldf/LibBuyTheDipGeometricDistribution.sol#L383)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 538](src/ldf/LibBuyTheDipGeometricDistribution.sol#L538)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 550](src/ldf/LibBuyTheDipGeometricDistribution.sol#L550)

	```solidity
	        int24 minTick = int24(uint24(bytes3(ldfParams << 8)));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 551](src/ldf/LibBuyTheDipGeometricDistribution.sol#L551)

	```solidity
	        int24 length = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 552](src/ldf/LibBuyTheDipGeometricDistribution.sol#L552)

	```solidity
	        uint32 alpha = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 553](src/ldf/LibBuyTheDipGeometricDistribution.sol#L553)

	```solidity
	        uint32 altAlpha = uint32(bytes4(ldfParams << 80));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 554](src/ldf/LibBuyTheDipGeometricDistribution.sol#L554)

	```solidity
	        int24 altThreshold = int24(uint24(bytes3(ldfParams << 112)));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 580](src/ldf/LibBuyTheDipGeometricDistribution.sol#L580)

	```solidity
	        int24 minTickOrOffset = int24(uint24(bytes3(ldfParams << 8)));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 581](src/ldf/LibBuyTheDipGeometricDistribution.sol#L581)

	```solidity
	        int24 length = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 582](src/ldf/LibBuyTheDipGeometricDistribution.sol#L582)

	```solidity
	        uint256 alpha = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 635](src/ldf/LibBuyTheDipGeometricDistribution.sol#L635)

	```solidity
	        minTick = int24(uint24(bytes3(ldfParams << 8))); // must be aligned to tickSpacing
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 636](src/ldf/LibBuyTheDipGeometricDistribution.sol#L636)

	```solidity
	        length = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 637](src/ldf/LibBuyTheDipGeometricDistribution.sol#L637)

	```solidity
	        uint256 alpha = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 639](src/ldf/LibBuyTheDipGeometricDistribution.sol#L639)

	```solidity
	        uint256 altAlpha = uint32(bytes4(ldfParams << 80));
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 641](src/ldf/LibBuyTheDipGeometricDistribution.sol#L641)

	```solidity
	        altThreshold = int24(uint24(bytes3(ldfParams << 112)));
	```

- Found in src/ldf/LibCarpetedDoubleGeometricDistribution.sol [Line: 426](src/ldf/LibCarpetedDoubleGeometricDistribution.sol#L426)

	```solidity
	            swapLiquidity = (liquidityDensityX96(roundedTick, tickSpacing, params) * totalLiquidity) >> 96;
	```

- Found in src/ldf/LibCarpetedDoubleGeometricDistribution.sol [Line: 515](src/ldf/LibCarpetedDoubleGeometricDistribution.sol#L515)

	```solidity
	            swapLiquidity = (liquidityDensityX96(roundedTick, tickSpacing, params) * totalLiquidity) >> 96;
	```

- Found in src/ldf/LibCarpetedDoubleGeometricDistribution.sol [Line: 561](src/ldf/LibCarpetedDoubleGeometricDistribution.sol#L561)

	```solidity
	        uint32 weightCarpet = uint32(bytes4(ldfParams << 192));
	```

- Found in src/ldf/LibCarpetedDoubleGeometricDistribution.sol [Line: 586](src/ldf/LibCarpetedDoubleGeometricDistribution.sol#L586)

	```solidity
	        params.weightCarpet = uint32(bytes4(ldfParams << 192));
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 421](src/ldf/LibCarpetedGeometricDistribution.sol#L421)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 517](src/ldf/LibCarpetedGeometricDistribution.sol#L517)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 562](src/ldf/LibCarpetedGeometricDistribution.sol#L562)

	```solidity
	        weightCarpet = uint32(bytes4(ldfParams << 80));
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 573](src/ldf/LibCarpetedGeometricDistribution.sol#L573)

	```solidity
	        uint32 weightCarpet = uint32(bytes4(ldfParams << 80));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 446](src/ldf/LibDoubleGeometricDistribution.sol#L446)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 593](src/ldf/LibDoubleGeometricDistribution.sol#L593)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 604](src/ldf/LibDoubleGeometricDistribution.sol#L604)

	```solidity
	        int24 minTickOrOffset = int24(uint24(bytes3(ldfParams << 8)));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 605](src/ldf/LibDoubleGeometricDistribution.sol#L605)

	```solidity
	        int24 length0 = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 606](src/ldf/LibDoubleGeometricDistribution.sol#L606)

	```solidity
	        uint32 alpha0 = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 607](src/ldf/LibDoubleGeometricDistribution.sol#L607)

	```solidity
	        uint256 weight0 = uint32(bytes4(ldfParams << 80));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 608](src/ldf/LibDoubleGeometricDistribution.sol#L608)

	```solidity
	        int24 length1 = int24(int16(uint16(bytes2(ldfParams << 112))));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 609](src/ldf/LibDoubleGeometricDistribution.sol#L609)

	```solidity
	        uint32 alpha1 = uint32(bytes4(ldfParams << 128));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 610](src/ldf/LibDoubleGeometricDistribution.sol#L610)

	```solidity
	        uint256 weight1 = uint32(bytes4(ldfParams << 160));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 661](src/ldf/LibDoubleGeometricDistribution.sol#L661)

	```solidity
	        length0 = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 662](src/ldf/LibDoubleGeometricDistribution.sol#L662)

	```solidity
	        uint256 alpha0 = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 663](src/ldf/LibDoubleGeometricDistribution.sol#L663)

	```solidity
	        weight0 = uint32(bytes4(ldfParams << 80));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 664](src/ldf/LibDoubleGeometricDistribution.sol#L664)

	```solidity
	        length1 = int24(int16(uint16(bytes2(ldfParams << 112))));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 665](src/ldf/LibDoubleGeometricDistribution.sol#L665)

	```solidity
	        uint256 alpha1 = uint32(bytes4(ldfParams << 128));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 666](src/ldf/LibDoubleGeometricDistribution.sol#L666)

	```solidity
	        weight1 = uint32(bytes4(ldfParams << 160));
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 673](src/ldf/LibDoubleGeometricDistribution.sol#L673)

	```solidity
	            int24 offset = int24(uint24(bytes3(ldfParams << 8))); // the offset applied to the twap tick to get the minTick
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 686](src/ldf/LibDoubleGeometricDistribution.sol#L686)

	```solidity
	            minTick = int24(uint24(bytes3(ldfParams << 8))); // must be aligned to tickSpacing
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 645](src/ldf/LibGeometricDistribution.sol#L645)

	```solidity
	                (liquidityDensityX96(roundedTick, tickSpacing, minTick, length, alphaX96) * totalLiquidity) >> 96;
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 736](src/ldf/LibGeometricDistribution.sol#L736)

	```solidity
	                (liquidityDensityX96(roundedTick, tickSpacing, minTick, length, alphaX96) * totalLiquidity) >> 96;
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 750](src/ldf/LibGeometricDistribution.sol#L750)

	```solidity
	        int24 minTickOrOffset = int24(uint24(bytes3(ldfParams << 8)));
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 751](src/ldf/LibGeometricDistribution.sol#L751)

	```solidity
	        int24 length = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 752](src/ldf/LibGeometricDistribution.sol#L752)

	```solidity
	        uint256 alpha = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 830](src/ldf/LibGeometricDistribution.sol#L830)

	```solidity
	        length = int24(int16(uint16(bytes2(ldfParams << 32))));
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 831](src/ldf/LibGeometricDistribution.sol#L831)

	```solidity
	        uint256 alpha = uint32(bytes4(ldfParams << 48));
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 836](src/ldf/LibGeometricDistribution.sol#L836)

	```solidity
	            int24 offset = int24(uint24(bytes3(ldfParams << 8))); // the offset applied to the twap tick to get the minTick
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 849](src/ldf/LibGeometricDistribution.sol#L849)

	```solidity
	            minTick = int24(uint24(bytes3(ldfParams << 8))); // must be aligned to tickSpacing
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 342](src/ldf/LibUniformDistribution.sol#L342)

	```solidity
	            swapLiquidity = (liquidityDensityX96(roundedTick, tickSpacing, tickLower, tickUpper) * totalLiquidity) >> 96;
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 432](src/ldf/LibUniformDistribution.sol#L432)

	```solidity
	            swapLiquidity = (liquidityDensityX96(roundedTick, tickSpacing, tickLower, tickUpper) * totalLiquidity) >> 96;
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 447](src/ldf/LibUniformDistribution.sol#L447)

	```solidity
	            int24 offset = int24(uint24(bytes3(ldfParams << 8))); // offset (in rounded ticks) of tickLower from the twap tick
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 448](src/ldf/LibUniformDistribution.sol#L448)

	```solidity
	            int24 length = int24(uint24(bytes3(ldfParams << 32))); // length of the position in rounded ticks
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 457](src/ldf/LibUniformDistribution.sol#L457)

	```solidity
	            int24 tickLower = int24(uint24(bytes3(ldfParams << 8)));
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 458](src/ldf/LibUniformDistribution.sol#L458)

	```solidity
	            int24 tickUpper = int24(uint24(bytes3(ldfParams << 32)));
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 476](src/ldf/LibUniformDistribution.sol#L476)

	```solidity
	            int24 offset = int24(uint24(bytes3(ldfParams << 8))); // offset of tickLower from the twap tick
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 477](src/ldf/LibUniformDistribution.sol#L477)

	```solidity
	            int24 length = int24(uint24(bytes3(ldfParams << 32))); // length of the position in rounded ticks
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 493](src/ldf/LibUniformDistribution.sol#L493)

	```solidity
	            tickLower = int24(uint24(bytes3(ldfParams << 8)));
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 494](src/ldf/LibUniformDistribution.sol#L494)

	```solidity
	            tickUpper = int24(uint24(bytes3(ldfParams << 32)));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 305](src/ldf/managed/LibOracleUniGeoDistribution.sol#L305)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 412](src/ldf/managed/LibOracleUniGeoDistribution.sol#L412)

	```solidity
	            ) >> 96;
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 424](src/ldf/managed/LibOracleUniGeoDistribution.sol#L424)

	```solidity
	        uint8 distributionType = uint8(bytes1(ldfParams << 8));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 425](src/ldf/managed/LibOracleUniGeoDistribution.sol#L425)

	```solidity
	        bool oracleIsTickLower = uint8(bytes1(ldfParams << 16)) != 0;
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 426](src/ldf/managed/LibOracleUniGeoDistribution.sol#L426)

	```solidity
	        int24 oracleTickOffset = int24(int16(uint16(bytes2(ldfParams << 24))));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 427](src/ldf/managed/LibOracleUniGeoDistribution.sol#L427)

	```solidity
	        int24 nonOracleTick = int24(uint24(bytes3(ldfParams << 40)));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 428](src/ldf/managed/LibOracleUniGeoDistribution.sol#L428)

	```solidity
	        uint32 alpha = uint32(bytes4(ldfParams << 64));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 473](src/ldf/managed/LibOracleUniGeoDistribution.sol#L473)

	```solidity
	        distributionType = DistributionType(uint8(bytes1(ldfParams << 8)));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 474](src/ldf/managed/LibOracleUniGeoDistribution.sol#L474)

	```solidity
	        bool oracleIsTickLower = uint8(bytes1(ldfParams << 16)) != 0;
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 475](src/ldf/managed/LibOracleUniGeoDistribution.sol#L475)

	```solidity
	        int24 oracleTickOffset = int24(int16(uint16(bytes2(ldfParams << 24))));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 476](src/ldf/managed/LibOracleUniGeoDistribution.sol#L476)

	```solidity
	        int24 nonOracleTick = int24(uint24(bytes3(ldfParams << 40)));
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 477](src/ldf/managed/LibOracleUniGeoDistribution.sol#L477)

	```solidity
	        uint256 alpha = uint32(bytes4(ldfParams << 64));
	```

- Found in src/lib/BunniHookLogic.sol [Line: 713](src/lib/BunniHookLogic.sol#L713)

	```solidity
	                rescaleFactor0 = 18 + bunniState.vault0Decimals - bunniState.currency0Decimals;
	```

- Found in src/lib/BunniHookLogic.sol [Line: 714](src/lib/BunniHookLogic.sol#L714)

	```solidity
	                rescaleFactor1 = 18 + bunniState.vault1Decimals - bunniState.currency1Decimals;
	```

- Found in src/lib/BunniHookLogic.sol [Line: 718](src/lib/BunniHookLogic.sol#L718)

	```solidity
	                : reserveBalance0.mulDivUp(10 ** rescaleFactor0, bunniState.reserve0).toUint120();
	```

- Found in src/lib/BunniHookLogic.sol [Line: 721](src/lib/BunniHookLogic.sol#L721)

	```solidity
	                : reserveBalance1.mulDivUp(10 ** rescaleFactor1, bunniState.reserve1).toUint120();
	```

- Found in src/lib/BunniHubLogic.sol [Line: 650](src/lib/BunniHubLogic.sol#L650)

	```solidity
	                params.currency0.isAddressZero() ? 18 : IERC20(Currency.unwrap(params.currency0)).decimals();
	```

- Found in src/lib/BunniHubLogic.sol [Line: 652](src/lib/BunniHubLogic.sol#L652)

	```solidity
	                params.currency1.isAddressZero() ? 18 : IERC20(Currency.unwrap(params.currency1)).decimals();
	```

- Found in src/lib/BunniHubLogic.sol [Line: 656](src/lib/BunniHubLogic.sol#L656)

	```solidity
	                (params.vault0 != ERC4626(address(0)) && 18 + vault0Decimals < currency0Decimals)
	```

- Found in src/lib/BunniHubLogic.sol [Line: 657](src/lib/BunniHubLogic.sol#L657)

	```solidity
	                    || (params.vault1 != ERC4626(address(0)) && 18 + vault1Decimals < currency1Decimals)
	```

- Found in src/lib/ExpMath.sol [Line: 48](src/lib/ExpMath.sol#L48)

	```solidity
	            int256 k = ((x << 96) / 54916777467707473351141471128 + 2 ** 95) >> 96;
	```

- Found in src/lib/ExpMath.sol [Line: 49](src/lib/ExpMath.sol#L49)

	```solidity
	            x = x - k * 54916777467707473351141471128;
	```

- Found in src/lib/ExpMath.sol [Line: 56](src/lib/ExpMath.sol#L56)

	```solidity
	            y = ((y * x) >> 96) + 57155421227552351082224309758442;
	```

- Found in src/lib/ExpMath.sol [Line: 58](src/lib/ExpMath.sol#L58)

	```solidity
	            p = ((p * y) >> 96) + 28719021644029726153956944680412240;
	```

- Found in src/lib/ExpMath.sol [Line: 59](src/lib/ExpMath.sol#L59)

	```solidity
	            p = p * x + (4385272521454847904659076985693276 << 96);
	```

- Found in src/lib/ExpMath.sol [Line: 63](src/lib/ExpMath.sol#L63)

	```solidity
	            q = ((q * x) >> 96) + 50020603652535783019961831881945;
	```

- Found in src/lib/ExpMath.sol [Line: 64](src/lib/ExpMath.sol#L64)

	```solidity
	            q = ((q * x) >> 96) - 533845033583426703283633433725380;
	```

- Found in src/lib/ExpMath.sol [Line: 65](src/lib/ExpMath.sol#L65)

	```solidity
	            q = ((q * x) >> 96) + 3604857256930695427073651918091429;
	```

- Found in src/lib/ExpMath.sol [Line: 66](src/lib/ExpMath.sol#L66)

	```solidity
	            q = ((q * x) >> 96) - 14423608567350463180887372962807573;
	```

- Found in src/lib/ExpMath.sol [Line: 67](src/lib/ExpMath.sol#L67)

	```solidity
	            q = ((q * x) >> 96) + 26449188498355588339934803723976023;
	```

- Found in src/lib/ExpMath.sol [Line: 84](src/lib/ExpMath.sol#L84)

	```solidity
	                ? int256((uint256(r) * 1002132753603162656746435578141647308) >> uint256(shift))
	```

- Found in src/lib/ExpMath.sol [Line: 85](src/lib/ExpMath.sol#L85)

	```solidity
	                : int256((uint256(r) * 1002132753603162656746435578141647308) << uint256(-shift));
	```

- Found in src/lib/Oracle.sol [Line: 402](src/lib/Oracle.sol#L402)

	```solidity
	            uint256 aAdjusted = a > time ? a : a + 2 ** 32;
	```

- Found in src/lib/Oracle.sol [Line: 403](src/lib/Oracle.sol#L403)

	```solidity
	            uint256 bAdjusted = b > time ? b : b + 2 ** 32;
	```

- Found in src/periphery/BunniQuoter.sol [Line: 766](src/periphery/BunniQuoter.sol#L766)

	```solidity
	            rescaleFactor0 = 18 + bunniState.vault0Decimals - bunniState.currency0Decimals;
	```

- Found in src/periphery/BunniQuoter.sol [Line: 767](src/periphery/BunniQuoter.sol#L767)

	```solidity
	            rescaleFactor1 = 18 + bunniState.vault1Decimals - bunniState.currency1Decimals;
	```

- Found in src/periphery/BunniQuoter.sol [Line: 771](src/periphery/BunniQuoter.sol#L771)

	```solidity
	            : reserveBalance0.mulDivUp(10 ** rescaleFactor0, bunniState.reserve0).toUint120();
	```

- Found in src/periphery/BunniQuoter.sol [Line: 774](src/periphery/BunniQuoter.sol#L774)

	```solidity
	            : reserveBalance1.mulDivUp(10 ** rescaleFactor1, bunniState.reserve1).toUint120();
	```

</details>



## L-7: Empty `require()` / `revert()` Statement

Use descriptive reason strings or custom errors for revert paths.

<details><summary>2 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 150](src/BunniHook.sol#L150)

	```solidity
	        require(
	```

- Found in src/BunniHub.sol [Line: 104](src/BunniHub.sol#L104)

	```solidity
	        require(
	```

</details>



## L-8: `nonReentrant` is Not the First Modifier

To protect against reentrancy in other modifiers, the `nonReentrant` modifier should be the first modifier in the list of modifiers.

<details><summary>1 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 529](src/BunniHook.sol#L529)

	```solidity
	        nonReentrant
	```

</details>



## L-9: Empty Block

Consider removing empty blocks.

<details><summary>3 Found Instances</summary>


- Found in src/base/ERC20.sol [Line: 273](src/base/ERC20.sol#L273)

	```solidity
	    function _constantNameHash() internal view virtual returns (bytes32 result) {}
	```

- Found in src/base/ERC20.sol [Line: 535](src/base/ERC20.sol#L535)

	```solidity
	    function _beforeTokenTransfer(address from, address to, uint256 amount) internal virtual {}
	```

- Found in src/base/ERC20.sol [Line: 539](src/base/ERC20.sol#L539)

	```solidity
	    function _afterTokenTransfer(address from, address to, uint256 amount) internal virtual {}
	```

</details>



## L-10: Internal Function Used Only Once

Instead of separating the logic into a separate function, consider inlining the logic into the calling function. This can reduce the number of function calls and improve readability.

<details><summary>21 Found Instances</summary>


- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 135](src/ldf/LibBuyTheDipGeometricDistribution.sol#L135)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/LibBuyTheDipGeometricDistribution.sol [Line: 161](src/ldf/LibBuyTheDipGeometricDistribution.sol#L161)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/ldf/LibCarpetedDoubleGeometricDistribution.sol [Line: 132](src/ldf/LibCarpetedDoubleGeometricDistribution.sol#L132)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/LibCarpetedDoubleGeometricDistribution.sol [Line: 213](src/ldf/LibCarpetedDoubleGeometricDistribution.sol#L213)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 127](src/ldf/LibCarpetedGeometricDistribution.sol#L127)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 194](src/ldf/LibCarpetedGeometricDistribution.sol#L194)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/ldf/LibCarpetedGeometricDistribution.sol [Line: 246](src/ldf/LibCarpetedGeometricDistribution.sol#L246)

	```solidity
	    function checkMinLiquidityDensity(int24 tickSpacing, int24 length, uint256 alpha, uint256 weightCarpet)
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 125](src/ldf/LibDoubleGeometricDistribution.sol#L125)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 160](src/ldf/LibDoubleGeometricDistribution.sol#L160)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/ldf/LibDoubleGeometricDistribution.sol [Line: 191](src/ldf/LibDoubleGeometricDistribution.sol#L191)

	```solidity
	    function checkMinLiquidityDensity(
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 310](src/ldf/LibGeometricDistribution.sol#L310)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/LibGeometricDistribution.sol [Line: 412](src/ldf/LibGeometricDistribution.sol#L412)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 128](src/ldf/LibUniformDistribution.sol#L128)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/LibUniformDistribution.sol [Line: 172](src/ldf/LibUniformDistribution.sol#L172)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 108](src/ldf/managed/LibOracleUniGeoDistribution.sol#L108)

	```solidity
	    function inverseCumulativeAmount0(
	```

- Found in src/ldf/managed/LibOracleUniGeoDistribution.sol [Line: 134](src/ldf/managed/LibOracleUniGeoDistribution.sol#L134)

	```solidity
	    function inverseCumulativeAmount1(
	```

- Found in src/lib/FullMathX96.sol [Line: 12](src/lib/FullMathX96.sol#L12)

	```solidity
	    function fullMulX96(uint256 x, uint256 y) internal pure returns (uint256 z) {
	```

- Found in src/lib/Math.sol [Line: 49](src/lib/Math.sol#L49)

	```solidity
	function weightedSum(uint256 value0, uint256 weight0, uint256 value1, uint256 weight1) pure returns (uint256) {
	```

- Found in src/lib/Math.sol [Line: 64](src/lib/Math.sol#L64)

	```solidity
	function percentDelta(uint256 a, uint256 b) pure returns (uint256) {
	```

- Found in src/lib/OrderHashMemory.sol [Line: 38](src/lib/OrderHashMemory.sol#L38)

	```solidity
	    function hash(IFloodPlain.Order memory order) internal pure returns (bytes32) {
	```

- Found in src/lib/SqrtPriceMath.sol [Line: 213](src/lib/SqrtPriceMath.sol#L213)

	```solidity
	    function absDiff(uint160 a, uint160 b) internal pure returns (uint256 res) {
	```

</details>



## L-11: Unused Error

Consider using or removing the unused error.

<details><summary>24 Found Instances</summary>


- Found in src/base/ERC20.sol [Line: 29](src/base/ERC20.sol#L29)

	```solidity
	    error TotalSupplyOverflow();
	```

- Found in src/base/ERC20.sol [Line: 32](src/base/ERC20.sol#L32)

	```solidity
	    error AllowanceOverflow();
	```

- Found in src/base/ERC20.sol [Line: 35](src/base/ERC20.sol#L35)

	```solidity
	    error AllowanceUnderflow();
	```

- Found in src/base/ERC20.sol [Line: 38](src/base/ERC20.sol#L38)

	```solidity
	    error InsufficientBalance();
	```

- Found in src/base/ERC20.sol [Line: 41](src/base/ERC20.sol#L41)

	```solidity
	    error InsufficientAllowance();
	```

- Found in src/base/ERC20.sol [Line: 44](src/base/ERC20.sol#L44)

	```solidity
	    error InvalidPermit();
	```

- Found in src/base/ERC20.sol [Line: 47](src/base/ERC20.sol#L47)

	```solidity
	    error PermitExpired();
	```

- Found in src/base/ERC20Lockable.sol [Line: 22](src/base/ERC20Lockable.sol#L22)

	```solidity
	    error BalanceOverflow();
	```

- Found in src/base/Errors.sol [Line: 35](src/base/Errors.sol#L35)

	```solidity
	error BunniToken__NotPoolManager();
	```

- Found in src/interfaces/IERC20Lockable.sol [Line: 17](src/interfaces/IERC20Lockable.sol#L17)

	```solidity
	    error AlreadyLocked();
	```

- Found in src/interfaces/IERC20Lockable.sol [Line: 20](src/interfaces/IERC20Lockable.sol#L20)

	```solidity
	    error AlreadyUnlocked();
	```

- Found in src/interfaces/IERC20Lockable.sol [Line: 23](src/interfaces/IERC20Lockable.sol#L23)

	```solidity
	    error NotUnlocker();
	```

- Found in src/interfaces/IERC20Lockable.sol [Line: 26](src/interfaces/IERC20Lockable.sol#L26)

	```solidity
	    error AccountLocked();
	```

- Found in src/interfaces/IOwnable.sol [Line: 11](src/interfaces/IOwnable.sol#L11)

	```solidity
	    error Unauthorized();
	```

- Found in src/interfaces/IOwnable.sol [Line: 14](src/interfaces/IOwnable.sol#L14)

	```solidity
	    error NewOwnerIsZeroAddress();
	```

- Found in src/interfaces/IOwnable.sol [Line: 17](src/interfaces/IOwnable.sol#L17)

	```solidity
	    error NoHandoverRequest();
	```

- Found in src/interfaces/IOwnable.sol [Line: 20](src/interfaces/IOwnable.sol#L20)

	```solidity
	    error AlreadyInitialized();
	```

- Found in src/lib/ExpMath.sol [Line: 22](src/lib/ExpMath.sol#L22)

	```solidity
	    error LnQ96Undefined();
	```

- Found in src/lib/ExpMath.sol [Line: 25](src/lib/ExpMath.sol#L25)

	```solidity
	    error ExpOverflow();
	```

- Found in src/lib/HookletLib.sol [Line: 38](src/lib/HookletLib.sol#L38)

	```solidity
	    error HookletLib__FailedHookletCall();
	```

- Found in src/lib/SqrtPriceMath.sol [Line: 15](src/lib/SqrtPriceMath.sol#L15)

	```solidity
	    error InvalidPriceOrLiquidity();
	```

- Found in src/lib/SqrtPriceMath.sol [Line: 16](src/lib/SqrtPriceMath.sol#L16)

	```solidity
	    error InvalidPrice();
	```

- Found in src/lib/SqrtPriceMath.sol [Line: 17](src/lib/SqrtPriceMath.sol#L17)

	```solidity
	    error NotEnoughLiquidity();
	```

- Found in src/lib/SqrtPriceMath.sol [Line: 18](src/lib/SqrtPriceMath.sol#L18)

	```solidity
	    error PriceOverflow();
	```

</details>



## L-12: Unused State Variable

State variable appears to be unused. No analysis has been performed to see if any inline assembly references it. Consider removing this unused variable.

<details><summary>2 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 77](src/BunniHook.sol#L77)

	```solidity
	    uint256 internal constant REBALANCE_OUTPUT_BALANCE_SLOT =
	```

- Found in src/BunniHook.sol [Line: 81](src/BunniHook.sol#L81)

	```solidity
	    uint256 internal constant REBALANCE_ACTIVE_SLOT = 0x81033a18d648f105cf4834b06051c94a8095dbf3ba7aa3cb9e7baead1658f20a;
	```

</details>



## L-13: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>1 Found Instances</summary>


- Found in src/lib/Oracle.sol [Line: 150](src/lib/Oracle.sol#L150)

	```solidity
	            for (uint32 i = current; i < next; i++) {
	```

</details>



## L-14: Unused Import

Redundant import statement. Consider removing it.

<details><summary>25 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 8](src/BunniHook.sol#L8)

	```solidity
	import {Hooks} from "@uniswap/v4-core/src/libraries/Hooks.sol";
	```

- Found in src/BunniHook.sol [Line: 9](src/BunniHook.sol#L9)

	```solidity
	import {TickMath} from "@uniswap/v4-core/src/libraries/TickMath.sol";
	```

- Found in src/BunniHook.sol [Line: 20](src/BunniHook.sol#L20)

	```solidity
	import {IERC1271} from "permit2/src/interfaces/IERC1271.sol";
	```

- Found in src/BunniHook.sol [Line: 40](src/BunniHook.sol#L40)

	```solidity
	import {BunniSwapMath} from "./lib/BunniSwapMath.sol";
	```

- Found in src/BunniHub.sol [Line: 7](src/BunniHub.sol#L7)

	```solidity
	import "@uniswap/v4-core/src/types/BalanceDelta.sol";
	```

- Found in src/BunniHub.sol [Line: 11](src/BunniHub.sol#L11)

	```solidity
	import {IUnlockCallback} from "@uniswap/v4-core/src/interfaces/callback/IUnlockCallback.sol";
	```

- Found in src/BunniToken.sol [Line: 13](src/BunniToken.sol#L13)

	```solidity
	import {IUnlockCallback} from "@uniswap/v4-core/src/interfaces/callback/IUnlockCallback.sol";
	```

- Found in src/BunniToken.sol [Line: 19](src/BunniToken.sol#L19)

	```solidity
	import "./base/Constants.sol";
	```

- Found in src/base/ERC20Lockable.sol [Line: 7](src/base/ERC20Lockable.sol#L7)

	```solidity
	import "./Constants.sol";
	```

- Found in src/interfaces/IBaseHook.sol [Line: 6](src/interfaces/IBaseHook.sol#L6)

	```solidity
	import {Hooks} from "@uniswap/v4-core/src/libraries/Hooks.sol";
	```

- Found in src/interfaces/IBunniHook.sol [Line: 8](src/interfaces/IBunniHook.sol#L8)

	```solidity
	import {IHooks} from "@uniswap/v4-core/src/interfaces/IHooks.sol";
	```

- Found in src/interfaces/IBunniHub.sol [Line: 9](src/interfaces/IBunniHub.sol#L9)

	```solidity
	import {BalanceDelta} from "@uniswap/v4-core/src/types/BalanceDelta.sol";
	```

- Found in src/lib/BunniHookLogic.sol [Line: 8](src/lib/BunniHookLogic.sol#L8)

	```solidity
	import {Hooks} from "@uniswap/v4-core/src/libraries/Hooks.sol";
	```

- Found in src/lib/BunniHookLogic.sol [Line: 11](src/lib/BunniHookLogic.sol#L11)

	```solidity
	import {SqrtPriceMath} from "@uniswap/v4-core/src/libraries/SqrtPriceMath.sol";
	```

- Found in src/lib/BunniHookLogic.sol [Line: 14](src/lib/BunniHookLogic.sol#L14)

	```solidity
	import {ERC20} from "solady/tokens/ERC20.sol";
	```

- Found in src/lib/BunniHookLogic.sol [Line: 32](src/lib/BunniHookLogic.sol#L32)

	```solidity
	import {BunniHook} from "../BunniHook.sol";
	```

- Found in src/lib/BunniHookLogic.sol [Line: 38](src/lib/BunniHookLogic.sol#L38)

	```solidity
	import {LiquidityAmounts} from "./LiquidityAmounts.sol";
	```

- Found in src/lib/BunniHubLogic.sol [Line: 13](src/lib/BunniHubLogic.sol#L13)

	```solidity
	import "@uniswap/v4-core/src/types/BalanceDelta.sol";
	```

- Found in src/lib/BunniHubLogic.sol [Line: 14](src/lib/BunniHubLogic.sol#L14)

	```solidity
	import "@uniswap/v4-core/src/libraries/SqrtPriceMath.sol";
	```

- Found in src/lib/BunniHubLogic.sol [Line: 15](src/lib/BunniHubLogic.sol#L15)

	```solidity
	import {TickMath} from "@uniswap/v4-core/src/libraries/TickMath.sol";
	```

- Found in src/lib/BunniHubLogic.sol [Line: 40](src/lib/BunniHubLogic.sol#L40)

	```solidity
	import {BunniToken} from "../BunniToken.sol";
	```

- Found in src/lib/BunniHubLogic.sol [Line: 44](src/lib/BunniHubLogic.sol#L44)

	```solidity
	import {LiquidityAmounts} from "./LiquidityAmounts.sol";
	```

- Found in src/lib/BunniSwapMath.sol [Line: 17](src/lib/BunniSwapMath.sol#L17)

	```solidity
	import {SqrtPriceMath} from "./SqrtPriceMath.sol";
	```

- Found in src/lib/BunniSwapMath.sol [Line: 18](src/lib/BunniSwapMath.sol#L18)

	```solidity
	import {LiquidityAmounts} from "./LiquidityAmounts.sol";
	```

- Found in src/periphery/BunniQuoter.sol [Line: 31](src/periphery/BunniQuoter.sol#L31)

	```solidity
	import {LiquidityAmounts} from "../lib/LiquidityAmounts.sol";
	```

</details>



## L-15: State Change Without Event

There are state variable changes in this function but no event is emitted. Consider emitting an event to enable offchain indexers to track the changes.

<details><summary>8 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 188](src/BunniHook.sol#L188)

	```solidity
	    function increaseCardinalityNext(PoolKey calldata key, uint32 cardinalityNext)
	```

- Found in src/BunniHook.sol [Line: 367](src/BunniHook.sol#L367)

	```solidity
	    function updateLdfState(PoolId id, bytes32 newState) external override {
	```

- Found in src/BunniHook.sol [Line: 525](src/BunniHook.sol#L525)

	```solidity
	    function beforeSwap(address sender, PoolKey calldata key, IPoolManager.SwapParams calldata params, bytes calldata)
	```

- Found in src/BunniHook.sol [Line: 567](src/BunniHook.sol#L567)

	```solidity
	    function rebalanceOrderHook(bool isPreHook, RebalanceOrderHookArgs calldata hookArgs)
	```

- Found in src/BunniHub.sol [Line: 243](src/BunniHub.sol#L243)

	```solidity
	    function hookHandleSwap(
	```

- Found in src/BunniHub.sol [Line: 325](src/BunniHub.sol#L325)

	```solidity
	    function hookSetIdleBalance(PoolKey calldata key, IdleBalance newIdleBalance) external notPaused(5) {
	```

- Found in src/BunniHub.sol [Line: 338](src/BunniHub.sol#L338)

	```solidity
	    function hookGive(PoolKey calldata key, bool isCurrency0, uint256 amount) external override notPaused(7) {
	```

- Found in src/BunniHub.sol [Line: 483](src/BunniHub.sol#L483)

	```solidity
	    function unlockCallback(bytes calldata data) external override returns (bytes memory) {
	```

</details>



## L-16: State Variable Could Be Immutable

State variables that are only changed in the constructor should be declared immutable to save gas. Add the `immutable` attribute to state variables that are only changed in the constructor

<details><summary>2 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 117](src/BunniHook.sol#L117)

	```solidity
	    address internal hookFeeRecipientController;
	```

- Found in src/BunniHook.sol [Line: 121](src/BunniHook.sol#L121)

	```solidity
	    uint256 internal deployTimestamp;
	```

</details>



## L-17: Unchecked Return

Function returns a value but it is ignored. Consider checking the return value.

<details><summary>25 Found Instances</summary>


- Found in src/BunniHook.sol [Line: 162](src/BunniHook.sol#L162)

	```solidity
	        poolManager_.setOperator(address(hub_), true);
	```

- Found in src/BunniHook.sol [Line: 321](src/BunniHook.sol#L321)

	```solidity
	                    weth.transfer(recipient, balance);
	```

- Found in src/BunniHook.sol [Line: 462](src/BunniHook.sol#L462)

	```solidity
	        poolManager.unlock(abi.encode(HookUnlockCallbackType.CURATOR_CLAIM_FEES, abi.encode(key, recipient)));
	```

- Found in src/BunniHook.sol [Line: 618](src/BunniHook.sol#L618)

	```solidity
	                poolManager.unlock(
	```

- Found in src/BunniHook.sol [Line: 672](src/BunniHook.sol#L672)

	```solidity
	                poolManager.unlock(
	```

- Found in src/BunniHook.sol [Line: 838](src/BunniHook.sol#L838)

	```solidity
	        hub.bunniTokenOfPool(id).transferFrom(from, address(this), amount);
	```

- Found in src/BunniHook.sol [Line: 842](src/BunniHook.sol#L842)

	```solidity
	        hub.bunniTokenOfPool(id).transfer(to, amount);
	```

- Found in src/BunniHook.sol [Line: 846](src/BunniHook.sol#L846)

	```solidity
	        poolManager.transfer(to, currency.toId(), amount);
	```

- Found in src/BunniHub.sol [Line: 194](src/BunniHub.sol#L194)

	```solidity
	            bunniToken.transferFrom(msgSender, address(this), params.shares);
	```

- Found in src/BunniHub.sol [Line: 262](src/BunniHub.sol#L262)

	```solidity
	            poolManager.transferFrom(address(key.hooks), address(this), inputToken.toId(), inputAmount);
	```

- Found in src/BunniHub.sol [Line: 282](src/BunniHub.sol#L282)

	```solidity
	            poolManager.transfer(address(key.hooks), outputToken.toId(), outputAmount);
	```

- Found in src/BunniHub.sol [Line: 347](src/BunniHub.sol#L347)

	```solidity
	            poolManager.transferFrom(address(key.hooks), address(this), key.currency0.toId(), amount); // interaction
	```

- Found in src/BunniHub.sol [Line: 350](src/BunniHub.sol#L350)

	```solidity
	            poolManager.transferFrom(address(key.hooks), address(this), key.currency1.toId(), amount); // interaction
	```

- Found in src/lib/BunniHubLogic.sol [Line: 507](src/lib/BunniHubLogic.sol#L507)

	```solidity
	        env.poolManager.unlock(
	```

- Found in src/lib/BunniHubLogic.sol [Line: 687](src/lib/BunniHubLogic.sol#L687)

	```solidity
	        env.poolManager.initialize(key, params.sqrtPriceX96);
	```

- Found in src/lib/HookletLib.sol [Line: 115](src/lib/HookletLib.sol#L115)

	```solidity
	        self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 131](src/lib/HookletLib.sol#L131)

	```solidity
	        self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 142](src/lib/HookletLib.sol#L142)

	```solidity
	            self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 155](src/lib/HookletLib.sol#L155)

	```solidity
	            self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 167](src/lib/HookletLib.sol#L167)

	```solidity
	            self.callHooklet(IHooklet.beforeDeposit.selector, abi.encodeCall(IHooklet.beforeDeposit, (sender, params)));
	```

- Found in src/lib/HookletLib.sol [Line: 193](src/lib/HookletLib.sol#L193)

	```solidity
	            self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 220](src/lib/HookletLib.sol#L220)

	```solidity
	            self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 248](src/lib/HookletLib.sol#L248)

	```solidity
	            self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 382](src/lib/HookletLib.sol#L382)

	```solidity
	        self.callHooklet(
	```

- Found in src/lib/HookletLib.sol [Line: 420](src/lib/HookletLib.sol#L420)

	```solidity
	            self.callHooklet(
	```

</details>



